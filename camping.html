<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Modifier ma cagnotte</title>
<style>
body { font-family: Arial; text-align:center; margin-top:50px; }
#total_personnel { font-size:30px; margin:10px; color:blue; }
#last { font-size:20px; color:green; }
</style>
</head>
<body>

<h1 id="titre"></h1>

<input type="number" id="montant" placeholder="Ajouter un montant">
<button onclick="ajouter()">Ajouter</button>

<div id="last">Dernière valeur ajoutée : 0</div>
<div id="total_personnel">Total de ce camping : 0</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Configuration Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBnTkiUSRgVlD0sLTuV0YV92LWkPWBQAbA",
  authDomain: "compteur-million-2.firebaseapp.com",
  databaseURL: "https://compteur-million-2-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "compteur-million-2",
  storageBucket: "compteur-million-2.firebasestorage.app",
  messagingSenderId: "226299332536",
  appId: "1:226299332536:web:4d79be3a4ed0b2ba50714d"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Récupérer l'ID camping depuis l'URL
const params = new URLSearchParams(window.location.search);
const campingId = params.get('id');
if(!campingId){
  document.body.innerHTML = "ID camping manquant !";
}
document.getElementById("titre").innerText = "Modifier la cagnotte - " + campingId;

// Référence Firebase pour ce camping
const campingRef = database.ref('campings/' + campingId);

let total_camping = 0;

// Lire le total initial depuis Firebase
campingRef.on('value', snapshot => {
  total_camping = snapshot.val() || 0;
  document.getElementById('total_personnel').innerText = "Total de ce camping : " + total_camping;
});

// Ajouter une valeur
function ajouter() {
  const montant = parseInt(document.getElementById('montant').value);
  if(!isNaN(montant)){
    campingRef.transaction(current => {
      return (current || 0) + montant;
    }, (err, committed, snapshot) => {
      if(err) console.error("Erreur Firebase :", err);
      else if(committed){
        document.getElementById('last').innerText = "Dernière valeur ajoutée : " + montant;
        document.getElementById('total_personnel').innerText = "Total de ce camping : " + snapshot.val();
        document.getElementById('montant').value = "";
      }
    });
  }
}
</script>

</body>
</html>
